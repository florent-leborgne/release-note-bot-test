# Release Note Bot â€” How it works

The release-note bot is a GitHub Actions workflow that uses AI to generate user-facing release note suggestions for pull requests. This document explains what the bot does, how it gathers context, what content rules it follows, and how the comment is structured for machine consumption.

## Workflow overview

```
PR labeled with release_note:* â†’ Gather PR context â†’ Call AI model â†’ Post interactive comment
```

### 1. Trigger

The bot activates when one of the following labels is added to a PR targeting `main`:

- `release_note:feature`
- `release_note:enhancement`
- `release_note:fix`
- `release_note:breaking`
- `release_note:deprecation`

### 2. Context gathering

The bot collects as much context as possible to produce an accurate summary:

| Source | What it captures |
|---|---|
| **PR metadata** | Title and description |
| **PR diff** | The actual code changes (truncated to 10,000 characters if very large) |
| **Changed files** | List of files with additions/deletions counts |
| **PR comments** | Human conversation on the PR (bot comments are filtered out) |
| **Linked issues** | Any issues referenced in the PR body (`#123`, `owner/repo#123`, or full GitHub URLs) â€” the bot fetches each issue's title and body |

### 3. AI generation

The bot calls the **GitHub Models API** (using OpenAI GPT-4.1) with all the gathered context. The AI model is instructed to produce a release note following specific content rules (see below).

### 4. Interactive comment

The bot posts a PR comment with:

- The suggested release note text (editable)
- A tip explaining the author can edit the comment directly
- An **Approved** checkbox

When the checkbox is checked, a separate workflow adds the `release-note:approved` label to the PR. Unchecking removes it.

## Comment structure

The bot comment uses a structured format with HTML comment markers so that other tools can reliably parse and extract the release note text. Here is the full template:

```markdown
<!-- release-note-bot -->
## ðŸ“‹ Suggested Release Note

> [!TIP]
> You can **edit this comment** to refine the wording. Check the box when done.

<!-- RELEASE_NOTE_START -->
The actual release note text goes here.
<!-- RELEASE_NOTE_END -->

- [ ] **Approved** â€” this release note is ready to be included.

---
_Generated by the release-note bot._
```

### Markers reference

| Marker | Purpose |
|---|---|
| `<!-- release-note-bot -->` | Identifies the comment as belonging to the bot. Used to find and update existing comments instead of posting duplicates. |
| `<!-- RELEASE_NOTE_START -->` | Marks the beginning of the release note text. |
| `<!-- RELEASE_NOTE_END -->` | Marks the end of the release note text. |
| `- [x] **Approved**` | When checked, triggers the approval workflow. The `x` can be lowercase or uppercase (`X`). |

### Extracting the release note programmatically

To extract the approved release note text from a PR comment using the GitHub API:

1. **Find the comment** â€” List PR comments and look for one containing `<!-- release-note-bot -->`
2. **Check approval** â€” Verify the comment body contains `- [x] **Approved**` or `- [X] **Approved**`
3. **Extract the text** â€” Use a regex to capture content between the markers:

```
/<!-- RELEASE_NOTE_START -->\n([\s\S]*?)\n<!-- RELEASE_NOTE_END -->/
```

The captured group contains the final, human-reviewed release note text.

### Example: extracting with `gh` CLI

```bash
# Get the release note from PR #123
gh api repos/owner/repo/issues/123/comments --jq '
  .[] | select(.body | contains("<!-- release-note-bot -->"))
  | .body
  | capture("<!-- RELEASE_NOTE_START -->\\n(?<note>[\\s\\S]*?)\\n<!-- RELEASE_NOTE_END -->")
  | .note
'
```

## Content rules

The AI model follows these rules when generating release notes:

### Voice and tone

- **Address the reader as "you"** â€” e.g., "You can now..." not "Users can now..."
- **Plain language** â€” avoid jargon and internal terminology where possible
- **Present tense** â€” "Adds", "Fixes", "Updates", not "Added", "Fixed"
- **Start with a verb** â€” the first word should be an action verb (Adds, Fixes, Updates, Removes, Deprecates, etc.)

### Format

- **One short paragraph** â€” no bullet points, no headings
- **No file names or code details** â€” describe the change from the user's perspective, not the implementation
- **Use the linked issues and comments** to understand *why* the change was made

### Word limits by change type

Word limits are intentionally tied to the type of change. The goal is to **give more space to changes that have a bigger impact on the product and its users**. A new feature deserves a fuller description so readers understand what's now possible and why it matters. A bug fix, on the other hand, usually needs just a single sentence â€” the reader only needs to know what was broken and that it's now fixed.

This approach keeps release notes scannable: high-impact changes stand out with richer descriptions, while smaller fixes and improvements stay concise and don't compete for the reader's attention.

The word limits below are maximums, not targets â€” shorter is always better.

| Label | Change type | Max words | Rationale |
|---|---|---|---|
| `release_note:feature` | New feature | 100 | New capabilities need enough space to explain what you can now do and why it matters. |
| `release_note:enhancement` | Enhancement | 50 | Improvements to existing features â€” readers already have context, so less explanation is needed. |
| `release_note:fix` | Bug fix | 30 | One sentence: what was broken, now it works. |
| `release_note:breaking` | Breaking change | No limit | Breaking changes need as much space as necessary to explain what changed, why, and what action the reader must take. |
| `release_note:deprecation` | Deprecation | No limit | Deprecations must clearly explain what is going away, when, and what to use instead. |

### Naming accuracy

The bot is instructed to **always use exact product and feature names** as they appear in the PR title and description. It must never abbreviate, paraphrase, or substitute them. For example:

- Write "ES|QL", not "EQL" or "ESQL"
- Write "Kibana", not "the dashboard tool"
- Write "Elastic Agent", not "the agent"

## Approval workflow

1. The bot posts the suggested release note as a PR comment
2. The PR author (or any collaborator) can **edit the comment** to refine the wording
3. When satisfied, they **check the Approved box**
4. A second workflow detects the checkbox change and adds the `release-note:approved` label
5. If the box is unchecked, the label is automatically removed

This two-step process ensures a human always reviews and approves the final text before it's used in release notes.
